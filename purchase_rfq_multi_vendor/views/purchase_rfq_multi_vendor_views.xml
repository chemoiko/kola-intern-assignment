<odoo>

    <!-- 
        This view extends the standard purchase order form to add a new "Vendors" and "Bids" tabs.
    -->
    <record id="purchase_order_form_inherited" model="ir.ui.view">
        <field name="name">purchase_order_form_customized</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form" />
        <field name="priority" eval="90" />
        <field name="arch" type="xml">
            <!-- Add smart button for bids count in the header -->
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button class="oe_stat_button" icon="fa-list-alt">
                    <field name="bid_count" widget="statinfo" string="Bids"/>
                </button>
            </xpath>
            
            <xpath expr="//page[@name='products']" position="after">
                <page name="vendors_page" string="Vendors"
                    invisible="state in ('purchase', 'done', 'cancel')">
                    <group>
                        <field name="rfq_vendor_ids">
                            <list editable="bottom">
                                <field name="sequence" widget="handle" />
                                <field name="partner_id" />
                            </list>
                            <form string="Vendor">
                                <group>
                                    <field name="sequence" invisible="1" />
                                    <field name="partner_id" />
                                </group>
                            </form>
                        </field>
                    </group>
                </page>
            </xpath>

        </field>
    </record>

    <!-- Separate view record to insert Bids after Vendors -->
    <record id="purchase_order_form_bids" model="ir.ui.view">
        <field name="name">purchase.order.form.bids</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form" />
        <field name="priority" eval="95" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='vendors_page']" position="after">
                <page name="bids_page" string="Bids">
                    <group>
                        <field name="bid_ids" readonly="state != 'sent'">
                            <list editable="bottom">
                                <field name="vendor_id" />
                                <!-- <field name="product_qty"/> -->
                                <field name="price_total" />
                                <field name="currency_id" />
                                <field name="date_expected" widget="date" />
                                <button name="action_set_won" type="object" icon="fa-check"
                                    title="Accept" class="btn-link" invisible="state == 'won'" />
                                <button name="action_set_lost" type="object" icon="fa-times"
                                    title="Refuse" class="btn-link" invisible="state == 'lost'" />
                                <field name="state" widget="badge"
                                    decoration-success="state == 'won'"
                                    decoration-danger="state == 'lost'" />
                            </list>
                            <form string="Bid">
                                <group>
                                    <field name="vendor_id" />
                                    <!-- <field name="product_qty"/> -->
                                    <field name="price_total" />
                                    <field name="currency_id" />
                                    <field name="date_expected" widget="date" />
                                    <field name="state" widget="badge"
                                        decoration-success="state == 'won'"
                                        decoration-danger="state == 'lost'" />
                                    <field name="state" />
                                    <field name="note" />
                                </group>
                                <footer>
                                    <button string="Accept" type="object" name="action_set_won"
                                        class="btn-primary" invisible="state == 'won'" />
                                    <button string="Refuse" type="object" name="action_set_lost"
                                        class="btn-secondary" invisible="state == 'lost'" />
                                </footer>
                            </form>
                        </field>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

</odoo>